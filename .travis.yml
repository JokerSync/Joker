language: cpp
branches:
  except:
  - "/^skipthisbranch$/"
env:
  global:
  - JOKER_RELEASE_PATH=$HOME
  - TESTS_RELEASE_PATH=$HOME
matrix:
  include:
  - env: UNCRUSTIFY
    os: osx
    install: brew install uncrustify
    before_script: echo N/A
    script: scripts/uncrustify.sh
  - env: DOXYGEN
    os: linux
    install: sudo apt-get update && sudo apt-get install doxygen
    before_script: echo N/A
    script: scripts/doxygen.sh
  - env:
    - QTVER=551
    - PROJECT=app/Joker/Joker.pro
    os: linux
  - env:
    - QTVER=551
    - PROJECT=app/Joker/Joker.pro
    os: osx
    after_script:
    - make prettydmg
    - export RELEASED_PACKAGE_FILENAME=$(ls -1 Joker_v*.dmg)
    - echo "RELEASED_PACKAGE_FILENAME:$RELEASED_PACKAGE_FILENAME"
  - env:
    - QTVER=551
    - PROJECT=specs/AllSpecs/AllSpecs.pro
    os: osx
    before_install: sudo pip install cpp-coveralls
    script:
    - make
    - travis_wait "./AllSpecs --reporter=spec"
    after_success: coveralls -E .+/moc_.+ -E .+/ui_.+ -E .+\.app -E .+/tests/.+ -E
      .+/app/.+ -E .+/specs/.+
    after_failure: "./scripts/upload.sh *.result.bmp"
  - env:
    - QTVER=551
    - PROJECT=app/LTCTool/LTCTool.pro
    os: osx
  - env:
    - QTVER=551
    - PROJECT=app/MidiTool/MidiTool.pro
    os: osx
  - env:
    - QTVER=551
    - PROJECT=tests/tests.pro
    os: osx
install:
- git submodule update --init --recursive
- ". scripts/install_qt.sh"
- scripts/install_ltc.sh
- scripts/install_ffmpeg.sh
- scripts/install_portaudio.sh
- scripts/install_rtmidi.sh
- if [[ "${TRAVIS_PULL_REQUEST}" == "false" ]] && [[ "${TRAVIS_OS_NAME}" == "osx"
  ]]; then scripts/add_key.sh; fi
before_script: qmake $PROJECT
script: make
